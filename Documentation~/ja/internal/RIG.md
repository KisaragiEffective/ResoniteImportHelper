# リグ

## 概要
RIH は Resoniteで 人形アバター (ヒューマノイド) のボーン構造を正しく認識させるために、ヒューマノイドのボーンに関係ないボーンをリグから除外するマークを付けます。

## リグの認識

以下の議論は正常にヒューマノイドとして認識されているリグの話です。そもそも壊れているリグや、ヒューマノイドではない一般のリグについては以下の議論は当てはまらず、よってすべてのボーンがそのまま出力されます。

RIH はモデルをインポートしたときに付与される `Animator` コンポーネントが持つ [`Avatar`](https://docs.unity3d.com/ja/2022.3/ScriptReference/Avatar.html) によってそのモデルのリグを判別します。

もしモデルのリグが「人形」(ひとがた) としてみなされる場合、そのボーン構造は人間に近い構造をしているとみなします。

RIH はモデルをインポートするときに[名前と階層によって構造を判別しようとする](https://wiki.resonite.com/Humanoid_Rig_Requirements_for_IK)ので、エッジケースを踏み抜くとIKが正常に認識されません。
例えば、真冬ちゃんはそのままだと`Chest_Belt` というボーンがChestに対応するボーンだと認識されてIKが壊れます。

一方で `Avatar` はアバター作者がVRChatで使用することを想定して適切なボーンを割り当てていることがほとんどなので、信頼できる構造をしています。

そこで、RIH は `Avatar` からヒューマノイドのリグが検出できた場合、それ以外のボーンの名前に一律 `<NoIK>` というマジックコメントを挿入します。
`<NoIK>` があることにより、インポートしたときにIKのボーンの候補として挙げられなくなるので正常にインポートすることができます。
